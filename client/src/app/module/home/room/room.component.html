<app-toast></app-toast>

<div *ngIf="player">
  <div class="tw-p-[var(--content-gap)] tw-grid tw-gap-[var(--content-gap)]">
    <!-- player list in the room -->
    <div class="tw-flex tw-gap-[var(--content-gap)]">
      <div *ngFor="let p of room.playerList">
        <p-button
          [label]="p.playerName"
          [outlined]="true"
          [severity]="p.playerId === player.playerId ? 'primary' : 'secondary'"
        ></p-button>
      </div>
    </div>

    <div class="tw-flex tw-gap-[var(--content-gap)]">
      <!-- start game -->
      <p-button
        [label]="'ACTION.START_GAME' | translate"
        (onClick)="startGame()"
        *ngIf="player.playerId === room.roomOwnerId"
      ></p-button>

      <!-- next player -->
      <p-button
        [label]="'Next player turn'"
        [outlined]="true"
        (onClick)="nextTurn()"
      ></p-button>
    </div>
  </div>

  <!-- display mahjong section -->
  <section class="display-mahjong-div">
    <!-- testing area (remaining mahjong) -->
    <!-- <div
      class="tw-flex tw-flex-wrap tw-gap-[var(--content-gap)] tw-p-[var(--content-gap)] tw-justify-center tw-items-center"
      cdkDropList
      cdkDropListOrientation="horizontal"
      (cdkDropListDropped)="drop($event, room.mahjong.remainingTiles)"
    >
      <div
        *ngFor="let mahjong of room.mahjong.remainingTiles; let i = index"
        class="tw-mx-[-4px]"
      >
        <app-mahjong
          [mahjong]="mahjong"
          [selectable]="false"
          cdkDrag
        ></app-mahjong>
      </div>
    </div> -->

    <!-- Player turn area -->
    <div
      class="tw-flex tw-gap-[var(--content-gap)] tw-p-[var(--content-gap)] tw-justify-center tw-items-center"
    >
      <app-game-turn [room]="room" [player]="player"></app-game-turn>
    </div>

    <app-mahjong-table [room]="room" [player]="player"></app-mahjong-table>
  </section>
</div>

<p-dialog
  [(visible)]="chowVisible"
  [modal]="true"
  [closable]="false"
  (onHide)="cancelChow()"
>
  <ng-template pTemplate="content">
    <div>
      <app-mahjong
        [mahjong]="
          room.mahjong.discardTiles[room.mahjong.discardTiles.length - 1]
        "
      ></app-mahjong>
    </div>

    <!-- hand set -->
    <div
      class="tw-p-[var(--content-gap)] tw-flex tw-flex-wrap"
      cdkDropList
      cdkDropListOrientation="horizontal"
      (cdkDropListDropped)="drop($event, player.mahjong.handTiles.mahjongTile)"
    >
      <div
        *ngFor="
          let mahjong of player.mahjong.handTiles.mahjongTile;
          let i = index
        "
        class="tw-mx-[-4px] tw-flex"
      >
        <app-mahjong
          [mahjong]="mahjong"
          cdkDrag
          (click)="(mahjong.isSelected != mahjong.isSelected)"
          (selectedTile)="selectedTileOutput2($event, player)"
        ></app-mahjong>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="tw-flex tw-justify-between">
      <p-button
        [label]="'BUTTON.CANCEL' | translate"
        (onClick)="cancelChow()"
        [outlined]="true"
      ></p-button>
      <p-button
        [label]="'BUTTON.OK' | translate"
        (onClick)="sendChow()"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>
